"use strict";var Base={src:function(e){return BASE_URL+"static/"+e},url:function(){return BASE_URL+Array.prototype.join.call(arguments,"-")},substitute:function(e,o){return e.replace(/{([^{}]+)}/g,function(e,t){var n=o[t];return"string"==typeof n||"number"==typeof n?n:e})},getStyle:function(e){$("head").append('<link rel="stylesheet" href="'+e+'">')},getScript:function(e){return $.ajax({url:e,dataType:"script",cache:!0})}};$.fn.imagePreview=function(){var i=$('<div class="image-preview" style="display:none;"></div>').appendTo("body"),a=$("<img/>").appendTo(i),r=!1,s=!1,c=null,e=$(window),l=e.width();e.on("resize",function(){l=e.width()}),$(this).on("mouseenter",function(){clearTimeout(c),a.attr("src",this.src);var e=$(this),t=e.height(),n=e.offset(),o=i.outerHeight();i.css({top:n.top-(o-t)/2,right:l-n.left+10}),r||(i.show(),r=!0),s||(i.addClass("ready"),s=!0)}).on("mouseleave",function(){c=setTimeout(function(){i.hide(),r=!1},300)})},$(function(e){var n,o=e("#message"),i=e("#messageText");window.showMessage=function(e,t){clearTimeout(n),i.text(e).attr("class",t||"inform"),o.addClass("down"),n=setTimeout(function(){o.removeClass("down")},6e3)},window.showError=function(e){showMessage(e,"error")};var t=e.cookie("serverMessage");t&&(showMessage(t),e.removeCookie("serverMessage",{path:BASE_URL})),e("input[data-type=float]").on("keyup",function(){this.value=this.value.replace(/[^\d.]/g,""),this.value=this.value.replace(/^\./g,""),this.value=this.value.replace(/\.{2,}/g,"."),this.value=this.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".")});var a=e("img.lazy");a.length&&Base.getScript(Base.src("common/jquery.lazyload.min.js")).done(function(){a.lazyload({load:function(){e(this).removeClass("lazy")}})});var r=e("a[rel=fancybox]");r.length&&(Base.getStyle(Base.src("common/fancybox/jquery.fancybox.min.css")),Base.getScript(Base.src("common/fancybox/jquery.fancybox.min.js")).done(function(){r.fancybox()})),e(".nav").each(function(){0===this.getElementsByTagName("li").length&&(this.style.display="none")})}),$(window).on("load",function(){var t=$(window),e=$("#main"),n=$("#side"),o=e.height(),i=n.height(),a=o-i+36;function r(){var e=t.scrollTop();36<e?n.addClass("fixed").css("top",Math.min(0,a-e)):n.removeClass("fixed").css("top","")}o<i||(t.on("scroll",r),r())}),$(function(i){var a=i("#listForm");if(a.length){var r,s=i("#checkAll"),c=a.find("[name^=id]:checkbox"),l=!1,h=0;s.on("change",function(){c.prop("checked",this.checked).parents("tr").toggleClass("checked",this.checked)}),c.on("click",function(e){var t=c.index(this),n=this.checked,o=t-r;(i(this).parents("tr").toggleClass("checked",n),e.shiftKey&&1<Math.abs(o)&&l===n)&&(0<o?c.slice(r+1,t):c.slice(t+1,r)).prop("checked",n).parents("tr").toggleClass("checked",n);r=t,l=n,(h=a.find("[name^=id]:checkbox:checked").length)?h===c.length?s.prop("indeterminate",!1).prop("checked",!0):s.prop("indeterminate",!0):s.prop("indeterminate",!1).prop("checked",!1)}),i("#sort").on("click",function(){(h=a.find("[name^=id]:checkbox:checked").length)?n("sort"):showError("请选择你要排序的内容")}),i("#del").on("click",function(){return(h=a.find("[name^=id]:checkbox:checked").length)?!!confirm("删除后内容将无法恢复，\n你确定要删除选中的 "+h+" 条记录吗？")&&void n("del"):(showError("请选择你要删除的内容"),!1)});var e=i("#move");e.length&&(e.html(i("#category").html()).find("option:eq(0)").text("移动到..."),e.on("change",function(){(h=a.find("[name^=id]:checkbox:checked").length)?n("move-"+e.val()):(showError("请选择你要移动的内容"),this.options[0].selected=!0)})),i("span[data-val]").click(function(){var e="1"===this.getAttribute("data-val")?"0":"1";this.setAttribute("data-val",e),i.get(this.getAttribute("data-href")+"?val="+e)}),i("a.del").on("click",function(e){e.preventDefault(),confirm("删除后内容将无法恢复，你确定要删除吗？")&&i.getJSON(this.href,function(e){e.code?(i.cookie("serverMessage",e.msg,{path:BASE_URL}),window.location.reload()):showError(e.msg)})});var t=i(".thumbnail");t.length&&t.imagePreview()}function n(e){var t=Base.url(CONTROLLER,"batch",e);i.post(t,a.serialize(),function(e){e.code?(i.cookie("serverMessage",e.msg,{path:BASE_URL}),window.location.reload()):showError(e.msg)},"json")}}),$(function(t){t("a[data-target=replace]").on("click",function(e){e.preventDefault(),location.replace(this.href)}),t(":checkbox[data-details]").change(function(){t(this.getAttribute("data-details")).toggle(this.checked)}),t("#ajaxForm").on("submit",function(e){e.preventDefault(),t.post(this.action,t(this).serialize(),function(e){e.code?showMessage(e.msg):showError(e.msg)})})}),$(function(){if("function"==typeof KindEditor){var e=$("textarea[data-editor]");if(e.length){var n={uploadJson:Base.url("Editor-upload"),fileManagerJson:Base.url("Editor-manager"),allowFileManager:!0,formatUploadUrl:!1,urlType:"relative",imageTabIndex:1,newlineTag:"br",filterMode:!1,cssPath:Base.src("admin/style/editor.css"),afterBlur:function(){this.sync()}},o=[],i=["source","|","undo","redo","|","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","lineheight","removeformat","|","justifyleft","justifycenter","justifyright","|","image","link","unlink","clearhtml"],a={code:1,emoticons:1};$.each(KindEditor.options.items,function(e,t){a[t]||o.push(t)}),e.each(function(e,t){n.items="simple"===t.getAttribute("data-editor")?i:o,KindEditor.create(t,n)})}}});